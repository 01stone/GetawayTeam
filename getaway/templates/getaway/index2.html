<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>GETAWAY</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../../static/getaway/assets/css/main.css" />
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
								<header id="header">
									<a href="index.html" class="logo"><strong>GETAWAY</strong> with BUDDY</a>
									<ul class="icons">
										{% load static %}
                                            <img src="/static/gateway/images/user.svg">
										<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
										<li><a href="#" class="icon brands fa-snapchat-ghost"><span class="label">Snapchat</span></a></li>
										<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
										<li><a href="#" class="icon brands fa-medium-m"><span class="label">Medium</span></a></li>
									</ul>
								</header>

							<!-- Banner -->
								<section id="banner">
									<div class="content">
										<header>
											<h1>Hi, I’m Editorial<br />
											by HTML5 UP</h1>
											<p>A free and fully responsive site template</p>
										</header>
										<p></p>
										<ul class="actions">
											<li><a href="#" class="button big">Learn More</a></li>
										</ul>
									</div>
									<span class="image object">
										<img src="images/pic10.jpg" alt="" />
									</span>
								</section>

							<!-- Section -->
															<section>
									<header class="major">
										<h2>추천 관광지</h2>
									</header>

                                        <div style="display: inline-block">
                                            <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example"
                                                style="width: 120px; text-align: center;" id="area_select"></select>
                                        </div>

                                        <div style="display: inline-block">
                                            <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example"
                                                style="width: 120px; text-align: center;" id="detail_select"></select>
                                        </div>
                                    <hr>
									<div class="posts" id="post_list">
										<article>
											<img/>
											<h3></h3>
											<p></p>
                                            <p></p>
											<ul class="actions">
												<li></li>
											</ul>
										</article>

									</div>
								</section>

						</div>
					</div>

				<!-- Sidebar -->
					<div id="sidebar">
						<div class="inner">

							<!-- Search -->
								<section id="search" class="alt">
									<form method="post" action="#">
										<input type="text" name="query" id="query" placeholder="Search" />
									</form>
								</section>

							<!-- Menu -->
								<nav id="menu">
									<header class="major">
										<h2>Menu</h2>
									</header>
									<ul>
										<li><a href="index.html">Homepage</a></li>
										<li><a href="generic.html">Generic</a></li>
										<li><a href="elements.html">Elements</a></li>
										<li>
											<span class="opener">Submenu</span>
											<ul>
												<li><a href="#">Lorem Dolor</a></li>
												<li><a href="#">Ipsum Adipiscing</a></li>
												<li><a href="#">Tempus Magna</a></li>
												<li><a href="#">Feugiat Veroeros</a></li>
											</ul>
										</li>
										<li><a href="#">Etiam Dolore</a></li>
										<li><a href="#">Adipiscing</a></li>
										<li>
											<span class="opener">Another Submenu</span>
											<ul>
												<li><a href="#">Lorem Dolor</a></li>
												<li><a href="#">Ipsum Adipiscing</a></li>
												<li><a href="#">Tempus Magna</a></li>
												<li><a href="#">Feugiat Veroeros</a></li>
											</ul>
										</li>
										<li><a href="#">Maximus Erat</a></li>
										<li><a href="#">Sapien Mauris</a></li>
										<li><a href="#">Amet Lacinia</a></li>
									</ul>
								</nav>

							<!-- Section -->
								<section>
									<header class="major">
										<h2>Ante interdum</h2>
									</header>
									<div class="mini-posts">
										<article>
											<a href="#" class="image"><img src="../../static/getaway/assets/images/pic07.jpg" alt="" /></a>
											<p>Aenean ornare velit lacus, ac varius enim lorem ullamcorper dolore aliquam.</p>
										</article>
										<article>
											<a href="#" class="image"><img src="../../static/getaway/assets/images/pic08.jpg" alt="" /></a>
											<p>Aenean ornare velit lacus, ac varius enim lorem ullamcorper dolore aliquam.</p>
										</article>
										<article>
											<a href="#" class="image"><img src="../../static/getaway/assets/images/pic09.jpg" alt="" /></a>
											<p>Aenean ornare velit lacus, ac varius enim lorem ullamcorper dolore aliquam.</p>
										</article>
									</div>
									<ul class="actions">
										<li><a href="#" class="button">More</a></li>
									</ul>
								</section>

							<!-- Section -->
								<section>
									<header class="major">
										<h2>Get in touch</h2>
									</header>
									<p>Sed varius enim lorem ullamcorper dolore aliquam aenean ornare velit lacus, ac varius enim lorem ullamcorper dolore. Proin sed aliquam facilisis ante interdum. Sed nulla amet lorem feugiat tempus aliquam.</p>
									<ul class="contact">
										<li class="icon solid fa-envelope"><a href="#">information@untitled.tld</a></li>
										<li class="icon solid fa-phone">(000) 000-0000</li>
										<li class="icon solid fa-home">1234 Somewhere Road #8254<br />
										Nashville, TN 00000-0000</li>
									</ul>
								</section>

							<!-- Footer -->
								<footer id="footer">
									<p class="copyright">&copy; Untitled. All rights reserved. Demo Images: <a href="https://unsplash.com">Unsplash</a>. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
								</footer>

						</div>
					</div>

			</div>

		<!-- Scripts -->
            <script type="text/javascript"></script>
			<script src="../../static/getaway/assets/js/jquery.min.js"></script>
			<script src="../../static/getaway/assets/js/browser.min.js"></script>
			<script src="../../static/getaway/assets/js/breakpoints.min.js"></script>
			<script src="../../static/getaway/assets/js/util.js"></script>
			<script src="../../static/getaway/assets/js/main.js"></script>
            <script>
                let area_1 = ['강남구', '강동구', '강북구', '강서구', '관악구', '광진구', '구로구', '금천구', '노원구', '도봉구', '동대문구', '동작구', '마포구', '서대문구', '서초구', '성동구', '성북구', '송파구', '양천구', '영등포구', '용산구', '은평구', '종로구', '중구', '중랑구']
                let area_2 = ['강화군', '계양구', '미추홀구', '남동구', '동구', '부평구', '서구', '연수구', '옹진군', '중구']
                let area_3 = ['대덕구', '동구', '서구', '유성구', '중구']
                let area_4 = ['남구', '달서구', '달성군', '동구', '북구', '서구', '수성구', '중구']
                let area_5 = ['광산구', '남구', '동구', '북구', '서구']
                let area_6 = ['강서구', '금정구', '기장군', '남구', '동구', '동래구', '부산진구', '북구', '사상구', '사하구', '서구', '수영구', '연제구', '영도구', '중구', '해운대구']
                let area_7 = ['중구', '남구', '동구', '북구', '울주군']
                let area_8 = ['세종특별자치시']
                let area_31 = ['가평군', '고양시', '과천시', '광명시', '광주시', '구리시', '군포시', '김포시', '남양주시', '동두천시', '부천시', '성남시', '수원시', '시흥시', '안산시', '안성시', '안양시', '양주시', '양평군', '여주시', '연천군', '오산시', '용인시', '의왕시', '의정부시', '이천시', '파주시', '평택시', '포천시', '하남시']
                let area_32 = ['강릉시', '고성군', '동해시', '삼척시', '속초시', '양구군', '양양군', '영월군', '원주시', '인제군', '정선군', '철원군', '춘천시', '태백시', '평창군', '홍천군', '화천군', '횡성군']
                let area_33 = ['괴산군', '단양군', '보은군', '영동군', '옥천군', '음성군', '제천시', '진천군', '청원군', '청주시', '충주시', '증평군']
                let area_34 = ['공주시', '금산군', '논산시', '당진시', '보령시', '부여군', '서산시', '서천군', '아산시', '예산군', '천안시', '청양군', '태안군', '홍성군', '계룡시']
                let area_35 = ['경산시', '경주시', '고령군', '구미시', '군위군', '김천시', '문경시', '봉화군', '상주시', '성주군', '안동시', '영덕군', '영양군', '영주시', '영천시', '예천군', '울릉군', '울진군', '의성군', '청도군', '청송군', '칠곡군', '포항시']
                let area_36 = ['거제시', '거창군', '고성군', '김해시', '남해군', '마산시', '밀양시', '사천시', '산청군', '양산시', '의령군', '진주시', '진해시', '창녕군', '창원시', '통영시', '하동군', '함안군', '함양군', '합천군']
                let area_37 = ['고창군', '군산시', '김제시', '남원시', '무주군', '부안군', '순창군', '완주군', '익산시', '임실군', '장수군', '전주시', '정읍시', '진안군']
                let area_38 = ['강진군', '고흥군', '곡성군', '광양시', '구례군', '나주시', '담양군', '목포시', '무안군', '보성군', '순천시', '신안군', '여수시', '영광군', '영암군', '완도군', '장성군', '장흥군', '진도군', '함평군', '해남군', '화순군']
                let area_39 = ['남제주군', '북제주군', '서귀포시', '제주시']
                let whole_area = {'서울': area_1, '인천': area_2, '대전': area_3, '대구': area_4, '광주': area_5, '부산': area_6, '울산': area_7, '세종': area_8, '경기': area_31, '강원': area_32, '충북': area_33, '충남': area_34, '경북': area_35, '경남': area_36, '전북': area_37, '전남': area_38, '제주': area_39}
                let area_key = {'서울': '1', '인천': '2', '대전': '3', '대구': '4', '광주': '5', '부산': '6', '울산': '7', '세종': '8', '경기': '31', '강원': '32', '충북': '33', '충남': '34', '경북': '35', '경남': '36', '전북': '37', '전남': '38', '제주': '39'}


                $(function (){
                    let area_select = $('#area_select');
                    let detail_select = $('#detail_select');

                    for(let area in whole_area){
                        area_select.append($('<option value="'+ area + '"></option>').text(area));
                    }
                    // 선택지 초기화
                    whole_area['서울'].forEach((value, index, array) => {
                        detail_select.append($('<option value="' + value + '"></option>').text(value));
                    })
                    let selected = $('#area_select option:selected')
                    let areaCode = area_key[selected.val()];
                    let sigunguCode = whole_area[selected.val()].indexOf($('#detail_select option:selected').val()) + 1;
                    bring_tour_with_areaCode(areaCode, sigunguCode);

                    // 변경 메서드
                    area_select.on('change', function (event) {
                        detail_select.empty();
                        whole_area[$('#area_select option:selected').val()].forEach((value, index, array) => {
                            detail_select.append($('<option value="' + value + '"></option>').text(value));
                        })
                    })
                    detail_select.on('change',function (event){

                        areaCode = area_key[selected.val()];
                        sigunguCode = whole_area[selected.val()].indexOf($('#detail_select option:selected').val()) + 1;
                        bring_tour_with_areaCode(areaCode, sigunguCode);

                    })


                })


                function bring_tour_with_areaCode(areaCode, sigunguCode){
                    let xhr = new XMLHttpRequest();
                    let url ='http://api.visitkorea.or.kr/openapi/service/rest/KorService/areaBasedList';
                    let queryParams = '?' + encodeURIComponent('ServiceKey') + '=' + 'lA29%2FannvhdQHnNE4mon7ZoyNq0ue6P%2FPnYQuFsfaZ7D8YedR6DOISotomyacj0u15iLaCeruqZUsGe%2F79DpRA%3D%3D';
                    queryParams += '&' + encodeURIComponent('MobileOS') + '=' + 'ETC';
                    queryParams += '&' + encodeURIComponent('MobileApp') + '=' + 'AppTest';
                    queryParams += '&' + encodeURIComponent('areaCode') + '=' + areaCode;
                    queryParams += '&' + encodeURIComponent('sigunguCode') + '=' + sigunguCode;
                    queryParams += '&' + encodeURIComponent('numOfRows') + '=' + '100';
                    queryParams += '&' + encodeURIComponent('contentTypeId') + '=' + '12';
                    queryParams += '&' + encodeURIComponent('overviewYN') + '=' + 'Y';
                    xhr.open('GET', url + queryParams);
                    xhr.onreadystatechange = function (){
                        if(this.readyState == 4){
                            $('.posts').empty();
                            $(this.responseText).find('item').each(function(index, item){
                                let post = $('.posts');
                                let article = $('<article></article>');
                                let image_add = $($(item).find('firstimage')[0]).text();
                                let t_title = $($(item).find('title')[0]).text();
                                let t_addr = $($(item).find('addr1')[0]).text();
                                let contentId = $($(item).find('contentid')[0]).text();

                                let xhr = new XMLHttpRequest();
                                let url ='http://api.visitkorea.or.kr/openapi/service/rest/KorService/detailCommon';
                                let queryParams = '?' + encodeURIComponent('ServiceKey') + '=' + 'lA29%2FannvhdQHnNE4mon7ZoyNq0ue6P%2FPnYQuFsfaZ7D8YedR6DOISotomyacj0u15iLaCeruqZUsGe%2F79DpRA%3D%3D';
                                queryParams += '&' + encodeURIComponent('MobileOS') + '=' + 'ETC';
                                queryParams += '&' + encodeURIComponent('MobileApp') + '=' + 'AppTest';
                                queryParams += '&' + encodeURIComponent('contentId') + '=' + contentId;
                                queryParams += '&' + encodeURIComponent('overviewYN') + '=' + 'Y';
                                xhr.open('GET', url + queryParams);
                                xhr.onreadystatechange = function (){
                                    if(this.readyState == 4){
                                        $(this.responseText).find('item').each(function(index, item){
                                            let explain = $($(item).find('overview')[0]).text().substr(0,100);

                                            post.append(article);
                                            article.append('<img src="' + image_add +'"/>');
                                            article.append('<h3>' + t_title + '</h3>');
                                            article.append('<p> 위치 : '+ t_addr + ' </p>');
                                            article.append('<p> 설명: ' + explain + ' ...</p>');
                                            article.append('<ul class="actions"><l1><a href="{% url 'getaway:tourboard' %}" id="btn_click_tour" class="button">More</a></l1></ul>');

                                            $('#btn_click_tour').on('click', function () {
                                                $.ajax({
                                                    type: 'POST',
                                                    url: "{% url 'getaway:tourdata' %}",
                                                    data: {
                                                        'title': t_title,
                                                        'loc': t_addr,
                                                        'img': image_add,
                                                        'explain': explain,
                                                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                                                    },
                                                    dataType: 'json',
                                                    success: function(response) {
                                                        alert('success')
                                                    },
                                                    error: function () {
                                                        alert('error')
                                                    }

                                                })
                                            })

                                        })
                                    }
                                }
                                xhr.send('');


                            })
                        }
                    }
                    xhr.send('');
                }

            </script>

	</body>
</html>